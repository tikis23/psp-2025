openapi: 3.0.3
info:
  title: Point of Sale (POS) API
  description: |-
    API specification for a modern SaaS Point of Sale system for catering and beauty businesses.
    It covers order management, reservations, user and merchant management, and financial configurations.
  version: 1.0.0
servers:
  - url: https://api.example.com/v1
    description: Production Server
paths:
  /auth/login:
    post:
      summary: User Login
      description: Authenticates a user and returns a JWT access token.
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
        '401':
          description: Invalid credentials
  
  /users:
    post:
      summary: Create User
      description: Creates a new user (employee or owner). Only business owners or SuperAdmins can create users.
      tags: [User Management]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInput'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request
        '403':
          description: Forbidden

  /users/{userId}:       
    get:
      summary: Get User details
      description: Returns the details for a user. Only business owers or SuperAdmins can get user details. 
      tags: [User Management]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Not found
        '403':
          description: Forbidden
    
    put:   
      summary: Update User details
      description: Allows updating user information
      tags: [User Management]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      requestBody:
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/UserInput'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Not found
        '403':
          description: Forbidden
    delete:
      summary: Delete User
      description: Allows updating user information
      tags: [User Management]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: User deleted
        '404':
          description: Not found
        '403':
          description: Forbidden
          
  /items:
    post:
      summary: Create a new item
      description: Creates a new item (service/product)
      tags: [Item Management]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemInput'
      responses:
        '201':
          description: Item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '400':
          description: Bad request
  
  /items/{itemId}:
    get:
      summary: Get Item details
      description: Returns the details for an Item
      tags: [Item Management]
      security:
        - bearerAuth: []
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '404':
          description: Not found   
    put:
      summary: Update Item details
      description: Allows updating item information
      tags: [Item Management]
      security:
        - bearerAuth: []
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemInput'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '400':
          description: Bad request 
        '404':
          description: Not found
    delete:
      summary: Delete item
      tags: [Item Management]
      security:
        - bearerAuth: []
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Item deleted
        '400':
          description: Cannot delete item in an open order
        '404':
          description: Not found
  
  /orders:
    post:
      summary: Create Order
      description: Creates a new empty order.
      tags: [Order Management]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                merchantId:
                  type: string
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Bad request

  /orders/{orderId}:
    get:
      summary: Get Order Details
      tags: [Order Management]
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Not found
    put:
      summary: Modify an open order
      description: Allows changing high-level details of an open order. Items are managed via /items endpoint.
      tags: [Order Management]
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [open, cancelled]
      responses:
        '200':
          description: Order updated
        '409':
          description: Cannot modify a closed order 

  /orders/{orderId}/items:
    post:
      summary: Add Item to Order
      tags: [Order Management]
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                productId:
                  type: string
                quantity:
                  type: integer
                variationId:
                  type: string
      responses:
        '200':
          description: Item added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Bad request
        '404':
          description: Not found
  
    get:
      summary: Get Order items
      tags: [Order Management]
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            
        - name: itemId
          in: query
          required: false
          schema:
            type: string
          description: Filter order items by itemId
          
        - name: itemName
          in: query
          required: false
          schema:
            type: string
          description: Filter order items by itemName
          
        - name: minItemPrice
          in: query
          required: false
          schema:
            type: number
          description: Minimum itemPrice
          
        - name: maxItemPrice
          in: query
          required: false
          schema:
            type: number
          description: Maximum itemPrice
          
        - name: minQuantity
          in: query
          required: false
          schema:
            type: integer
          description: Minimum quantity
          
        - name: maxQuantity
          in: query
          required: false
          schema:
            type: integer
          description: Maximum quantity

        - name: sortBy
          in: query
          required: false
          schema:
            type: string
            enum: [id, itemId, itemName, itemPrice, quantity, taxRateValue]
            default: id
          description: Field to sort by
          
        - name: sortOrder
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: asc
          description: Sort direction
          
        - name: startAt
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: starting item index
        
        - name: maxResults
          in: query
          required: false
          schema:
            type: integer
            default: 10
          description: maximum number of items to return per page
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  isLast:
                    type: boolean
                    description: Indicates whether this is the last page of paginated response
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderItem'
                
        '404':
          description: Not found

  /orders/{orderId}/pay:
    post:
      summary: Pay for an Order
      description: Processes a full or partial payment for an order. Supports split checks.
      tags: [Order Management]
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                  format: double
                paymentMethod:
                  type: string
                  enum: [cash, card, gift_card]
                tip:
                  type: number
                  format: double
                stripeToken:
                  type: string
                  description: Required if paymentMethod is 'card'.
      responses:
        '200':
          description: Payment successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Bad request
        '402':
          description: Payment failed
        '404':
          description: Not found

  /orders/{orderId}/refund:
    post:
      summary: Refund a Closed Order
      tags: [Order Management]
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order refunded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Not found
        '409':
          description: Conflict - order is not closed

  /reservations:
    post:
      summary: Create Reservation
      description: Books a new appointment for a service.
      tags: [Reservation Management]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationInput'
      responses:
        '201':
          description: Reservation created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Reservation'
        '400':
          description: Bad request
        '402':
          description: Reservation failed

  /reservations/{reservationId}:
    put:
      summary: Modify Reservation
      tags: [Reservation Management]
      security:
        - bearerAuth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationInput'
      responses:
        '200':
          description: Reservation updated
    delete:
      summary: Cancel Reservation
      tags: [Reservation Management]
      security:
        - bearerAuth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Reservation cancelled
        '404':
          description: Not found

  /taxes:
    post:
      summary: Create Tax Rate. Elevated permissions required.
      tags: [System Management]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaxRateInput'
      responses:
        '201':
          description: Tax rate created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaxRate'
        '400':
          description: Bad request
        '403':
          description: Forbidden
  
  /taxes/{taxRateId}:
    delete:
      summary: Delete Tax Rate
      tags: [System Management]
      security:
        - bearerAuth: []
      parameters:
        - name: taxRateId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Tax Rate deleted
        '400':
          description: Cannot delete Tax Rate used in an open order
        '403':
          description: Forbidden
  
  /discounts:
    post:
      summary: Create Discount
      tags: [System Management]
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Discount'
      responses:
        '201':
          description: Discount created
        '403':
          description: Forbidden
          
  /discounts/{discountId}:
    delete:
      summary: Delete discount
      tags: [System Management]
      security:
        - bearerAuth: []
      parameters:
        - name: discountId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Discount deleted
        '400':
          description: Cannot delete Discount used in an open order
        '403':
          description: Forbidden
          
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [SuperAdmin, BusinessOwner, Employee]
        merchantId:
          type: string
    UserInput:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
        role:
          type: string
          enum: [BusinessOwner, Employee]
        merchantId:
          type: string
    
    Order:
      type: object
      properties:
        id:
          type: string
        merchantId:
          type: string
        status:
          type: string
          enum: [open, closed, paid, cancelled, refunded]
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        subtotal:
          type: number
        taxAmount:
          type: number
        discountAmount:
          type: number
        total:
          type: number
        payments:
          type: array
          items:
            $ref: '#/components/schemas/Payment'
        createdAt:
          type: string
          format: date-time
    
    OrderItem:
      type: object
      properties:
        id:
          type: string
        itemId:
          type: string
        itemName:
          type: string
        itemPrice:
          type: number
        quantity:
          type: integer
        taxRateId:
          type: string
        taxRateValue:
          type: number
          description: "e.g., 0.21 for 21%"
          
    Item:
      type: object
      properties:
        id: 
          type: string
        name:
          type: string
        price:
          type: number
        taxRateId:
          type: string
        
    ItemInput:
      type: object
      properties:
        name:
          type: string
        price:
          type: number
        taxRateId:
          type: string
          
          
    Payment:
      type: object
      properties:
        id:
          type: string
        amount:
          type: number
        paymentMethod:
          type: string
        tip:
          type: number
        status:
          type: string
          enum: [succeeded, failed]
        createdAt:
          type: string
          format: date-time
          
    Reservation:
      type: object
      properties:
        id:
          type: string
        serviceId:
          type: string
        employeeId:
          type: string
        customerId:
          type: string
        appointmentTime:
          type: string
          format: date-time
        status:
          type: string
          enum: [confirmed, cancelled]
    ReservationInput:
      type: object
      properties:
        serviceId:
          type: string
        employeeId:
          type: string
        customerName:
          type: string
        customerContact:
          type: string
        appointmentTime:
          type: string
          format: date-time

    TaxRate:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        rate:
          type: number
          description: "e.g., 0.21 for 21%"
        status:
          type: string
          enum: [active, inactive]
    TaxRateInput:
      type: object
      properties:
        name:
          type: string
        rate:
          type: number
          description: "e.g., 0.21 for 21%"
        isActive: 
          type: string
          enum: [active, inactive]

    Discount:
      type: object
      properties:
        id:
          type: string
        code:
          type: string
        description:
          type: string
        value:
          type: number
        type:
          type: string
          enum: [percentage, fixed_amount]
        scope:
          type: string
          enum: [order, product]
        productId:
          type: string
        validFrom:
          type: string
          format: date-time
        validTo:
          type: string
          format: date-time
